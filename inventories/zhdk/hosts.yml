zhdk:
  hosts:

    staging:
      ansible_ssh_host: zhdk-madek-staging.ruby.zhdk.ch
      madek_external_hostname: staging.madek.zhdk.ch
      zhdk_agw_api_id: madektest
      zhdk_agw_api_key: "{{zhdk_agw_api_test_key}}"
      zhdk_agw_api_url: "https://intern.zhdk.ch/?auth/{{zhdk_agw_api_test_app}}"
      agw_auth_public_key: |
        -----BEGIN PUBLIC KEY-----
        MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEJCGE8RbZhtTj+93HMSkSKMbWv4/X
        +87MRVYtJMoYSa3F9HONSSCkSbCNcpz4QBqLLcd4KCJGUFHCRowp4Trw0Q==
        -----END PUBLIC KEY-----
      agw_auth_madek_public_key: |
        -----BEGIN PUBLIC KEY-----
        MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEfv30vIA7yLtLDf2ISVCohxmh1Tby
        4cPaxmCiXbFes2IqlYDDVk0hdk8q8/OFKKKfWGd90c7V6n9zJsr0Xs22ug==
        -----END PUBLIC KEY-----

    prod: {}

    test:
      ansible_ssh_host: zhdk-madek-test.ruby.zhdk.ch
      madek_external_hostname: test.madek.zhdk.ch
      zhdk_agw_api_id: madektest
      zhdk_agw_api_key: "{{zhdk_agw_api_test_key}}"
      zhdk_agw_api_url: "https://intern.zhdk.ch/?auth/{{zhdk_agw_api_test_app}}"

  children:
    dev:

  vars:
    ansible_ssh_user: root
    zhdk_integration: True
    madek_storage_dir: /opt/madekdata
    madek_file_storage_dir: /opt/madekdata/attachments
    madek_thumbnail_storage_dir: /opt/madekdata/attachments
    db_backups_dir: "{{madek_storage_dir}}/backups"
    restore_structure_and_data_file: "{{db_backups_dir}}/latest.pgbin"
    zencoder_enabled: True
    zencoder_api_key: "{{zhdk_zencoder_api_key}}"

    madek_virtual_hosts:
    - hostname: "{{madek_external_hostname}}"
      ip: "*"
      ssl_certificate_file: '/etc/ssl/localcerts/zhdk-madek-{{inventory_hostname}}.ruby.zhdk.ch.crt'
      ssl_certificate_key_file: '/etc/ssl/localcerts/zhdk-madek-{{inventory_hostname}}.ruby.zhdk.ch.key'
      force_redirect_to_https: yes

prod:
  hosts:
    prod:

dev:
  hosts:
    jan: {}
    manuel: {}
    nimaai: {}
    tom: {}
    uvb: {}
  vars:
    ansible_host: '{{inventory_hostname}}-madek.ruby.zhdk.ch'
    external_hostname: '{{inventory_hostname}}.madek.rubydev.zhdk.ch'
    madek_external_hostname: '{{inventory_hostname}}.madek.rubydev.zhdk.ch'
    madek_virtual_hosts:
    - hostname: "{{madek_external_hostname}}"
      ip: "*"
      ssl_certificate_file: '/etc/ssl/localcerts/{{ansible_host}}.crt'
      ssl_certificate_key_file: '/etc/ssl/localcerts/{{ansible_host}}.key'
      force_redirect_to_https: yes

non_prod:
  children:
    dev:
    staging:
  hosts:
    staging:
    test:
  vars:
    db_backups_enabled: False
    restore_structure_and_data: yes
    setup_storage_directories: no # dont do it, files are mounted read-only!
    zencoder_test_mode: True
    madek_disallow_search_engine_crawlers: yes
    zhdk_integration: True
    zhdk_agw_api_key: "{{zhdk_agw_api_test_key}}"
    zhdk_agw_api_url: "https://intern.zhdk.ch/?auth/{{zhdk_agw_api_test_app}}"
    restrict_access_via_basic_auth: true
    restrict_access_via_basic_auth_passwords:
      Madek: "{{madek_zhdk_basic_auth_password}}"
    webstats_passwords_set:
      Madek: "{{madek_zhdk_basic_auth_password}}"
    webstats_enabled: True


madek:
  children:
    zhdk:
    dev:

secrets:
  children:
    zhdk:
    dev:

